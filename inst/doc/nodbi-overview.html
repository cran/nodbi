<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>nodbi - package overview</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">nodbi - package overview</h1>



<div id="summary" class="section level2">
<h2>Summary</h2>
<p>R package <code>nodbi</code> provides a single interface for several
NoSQL databases and SQL databases with JSON functionality, with the same
function parameters and return values across all of:</p>
<ul>
<li>MongoDB</li>
<li>SQLite</li>
<li>PostgreSQL</li>
<li>DuckDB</li>
<li>Elasticsearch</li>
<li>CouchDB</li>
</ul>
<p>Package <code>nodbi</code> has been designed to use any specific SQL
functions a database may have for <code>JSON</code> and has added
functionality tested for performance to enable switching databases
without changing user code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(nodbi)</span></code></pre></div>
</div>
<div id="functionality" class="section level2">
<h2>Functionality</h2>
<div id="connect" class="section level3">
<h3>Connect</h3>
<p>First, a connection to a database is opened. In the example, no
additional parameters are used such as database file or server; see the
help page for the respective database.</p>
<p>“Container” is used as term to indicate where conceptually the
database holds the data (e.g. a collection in MongoDB, a table in
DuckDB). The <code>key</code> parameter of <code>nodbi</code> functions
holds the name of the relevant container.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># name of container</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="st">&quot;my_container&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># nodbi can connect any of these databases</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  src <span class="ot">&lt;-</span> <span class="fu">src_duckdb</span>()</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  src <span class="ot">&lt;-</span> <span class="fu">src_mongo</span>(<span class="at">collection =</span> key)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  src <span class="ot">&lt;-</span> <span class="fu">src_sqlite</span>()</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  src <span class="ot">&lt;-</span> <span class="fu">src_postgres</span>()</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  src <span class="ot">&lt;-</span> <span class="fu">src_elastic</span>()</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  src <span class="ot">&lt;-</span> <span class="fu">src_couchdb</span>(</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="at">user =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;COUCHDB_TEST_USER&quot;</span>),</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    <span class="at">pwd =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;COUCHDB_TEST_PWD&quot;</span>)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  )</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co"># this example is run with</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>src <span class="ot">&lt;-</span> <span class="fu">src_sqlite</span>()</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; Warning: Database is only in memory, will not persist after R ends! Consider copying it with </span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; RSQLite::sqliteCopyDatabase(</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt;   from = &lt;your nodbi::src_sqlite() object&gt;$con, </span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt;   to = &lt;e.g. RSQLite::dbConnect(RSQLite::SQLite(), &#39;local_file.sqlite&#39;)&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt;   )</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co"># note additional parameters can be specified,</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co"># for example for local or remote MongoDb:</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="fu">help</span>(<span class="st">&quot;src_mongo&quot;</span>)</span></code></pre></div>
</div>
<div id="docdb_create" class="section level3">
<h3>docdb_create</h3>
<p>Create a container if it does not yet exist and fill with
<code>value</code>. The return value is the number of created documents.
“Documents” refers to the rows in a data frame such as
<code>mtcars</code>, or the number of <code>NDJSON</code> lines, or the
number of list items, or the number of objects in an <code>JSON</code>
array.</p>
<p>The parameter <code>value</code> in any <code>nodbi</code> function
can take a data frame, a list, a JSON string, or a file name or URL
pointing to <code>NDJSON</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># check if container already exists</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">docdb_exists</span>(<span class="at">src =</span> src, <span class="at">key =</span> key)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># load data from a data frame with row names into</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># the container specified in &quot;key&quot; parameter</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">docdb_create</span>(<span class="at">src =</span> src, <span class="at">key =</span> key, <span class="at">value =</span> mtcars)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; [1] 32</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co"># do not run during testing</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="co"># load additionally 98 NDJSON records</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="fu">docdb_create</span>(src, key, <span class="st">&quot;https://httpbin.org/stream/98&quot;</span>)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co"># load additionally mapdata as list</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">docdb_create</span>(src, key, jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(mapdata, <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>))</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; Note: container &#39;my_container&#39; already exists</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co"># show JSON structure of contacts</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>jsonlite<span class="sc">::</span><span class="fu">minify</span>(contacts)</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; [{&quot;_id&quot;:&quot;5cd67853f841025e65ce0ce2&quot;,&quot;isActive&quot;:false,&quot;balance&quot;:&quot;$3,808.45&quot;,&quot;age&quot;:23,&quot;eyeColor&quot;:&quot;green&quot;,&quot;name&quot;:&quot;Lacy Chen&quot;,&quot;email&quot;:&quot;lacychen@conjurica.com&quot;,&quot;about&quot;:&quot;Sunt consequat ad dolore.\nExercitation nisi reprehenderit.&quot;,&quot;registered&quot;:&quot;2014-08-03T12:11:54 -02:00&quot;,&quot;tags&quot;:[&quot;nulla&quot;,&quot;nisi&quot;,&quot;adipisicing&quot;,&quot;do&quot;,&quot;ad&quot;,&quot;ullamco&quot;,&quot;irure&quot;],&quot;friends&quot;:[{&quot;id&quot;:0,&quot;name&quot;:&quot;Wooten Goodwin&quot;},{&quot;id&quot;:1,&quot;name&quot;:&quot;Brandie Woodward&quot;},{&quot;id&quot;:2,&quot;name&quot;:&quot;Angelique Britt&quot;}]},{&quot;_id&quot;:&quot;5cd678531b423d5f04cfb0a1&quot;,&quot;isActive&quot;:false,&quot;balance&quot;:&quot;$3,400.50&quot;,&quot;age&quot;:20,&quot;eyeColor&quot;:&quot;brown&quot;,&quot;name&quot;:&quot;Rae Colon&quot;,&quot;email&quot;:&quot;raecolon@conjurica.com&quot;,&quot;about&quot;:&quot;Nisi excepteur duis duis aliquip qui id consequat consequat.&quot;,&quot;registered&quot;:&quot;2018-12-19T06:23:35 -01:00&quot;,&quot;tags&quot;:[&quot;nostrud&quot;,&quot;eu&quot;,&quot;consectetur&quot;,&quot;adipisicing&quot;,&quot;labore&quot;,&quot;ut&quot;,&quot;voluptate&quot;],&quot;friends&quot;:[{&quot;id&quot;:0,&quot;name&quot;:&quot;Yang Yates&quot;},{&quot;id&quot;:1,&quot;name&quot;:&quot;Lacy Chen&quot;}]},{&quot;_id&quot;:&quot;5cd6785335b63cb19dfa8347&quot;,&quot;isActive&quot;:false,&quot;balance&quot;:&quot;$2,579.09&quot;,&quot;age&quot;:30,&quot;eyeColor&quot;:&quot;brown&quot;,&quot;name&quot;:&quot;Williamson French&quot;,&quot;email&quot;:&quot;williamsonfrench@conjurica.com&quot;,&quot;about&quot;:&quot;Nulla do sunt consectetur officia. Laboris pariatur incididunt.&quot;,&quot;registered&quot;:&quot;2018-02-14T10:59:57 -01:00&quot;,&quot;tags&quot;:[&quot;exercitation&quot;,&quot;do&quot;,&quot;magna&quot;,&quot;ut&quot;,&quot;consectetur&quot;,&quot;ex&quot;,&quot;incididunt&quot;],&quot;friends&quot;:[{&quot;id&quot;:0,&quot;name&quot;:&quot;Coleen Dunn&quot;},{&quot;id&quot;:1,&quot;name&quot;:&quot;Doris Phillips&quot;},{&quot;id&quot;:2,&quot;name&quot;:&quot;Concetta Turner&quot;}]},{&quot;_id&quot;:&quot;5cd6785325ce3a94dfc54096&quot;,&quot;isActive&quot;:true,&quot;balance&quot;:&quot;$1,161.52&quot;,&quot;age&quot;:22,&quot;eyeColor&quot;:&quot;brown&quot;,&quot;name&quot;:&quot;Pace Bell&quot;,&quot;email&quot;:&quot;pacebell@conjurica.com&quot;,&quot;about&quot;:&quot;Eiusmod sunt laborum ipsum do cupidatat qui id dolore do.&quot;,&quot;registered&quot;:&quot;2018-08-17T12:23:42 -02:00&quot;,&quot;tags&quot;:[&quot;aliqua&quot;,&quot;consectetur&quot;,&quot;commodo&quot;,&quot;velit&quot;,&quot;cupidatat&quot;,&quot;duis&quot;,&quot;dolore&quot;],&quot;friends&quot;:[{&quot;id&quot;:0,&quot;name&quot;:&quot;Baird Keller&quot;},{&quot;id&quot;:1,&quot;name&quot;:&quot;Francesca Reese&quot;},{&quot;id&quot;:2,&quot;name&quot;:&quot;Dona Bartlett&quot;}]},{&quot;_id&quot;:&quot;5cd678530df22d3625ed8375&quot;,&quot;isActive&quot;:true,&quot;balance&quot;:&quot;$2,412.67&quot;,&quot;age&quot;:20,&quot;eyeColor&quot;:&quot;blue&quot;,&quot;name&quot;:&quot;Krista Baxter&quot;,&quot;email&quot;:&quot;kristabaxter@conjurica.com&quot;,&quot;about&quot;:&quot;Sint quis nulla ea fugiat. Commodo nisi qui eu sit.&quot;,&quot;registered&quot;:&quot;2017-07-19T05:03:47 -02:00&quot;,&quot;tags&quot;:[&quot;sit&quot;,&quot;cillum&quot;,&quot;commodo&quot;,&quot;labore&quot;,&quot;sint&quot;,&quot;in&quot;,&quot;exercitation&quot;],&quot;friends&quot;:[{&quot;id&quot;:0,&quot;name&quot;:&quot;Pace Bell&quot;}]}]</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co"># load additionally contacts JSON data</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="fu">docdb_create</span>(src, key, contacts)</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; Note: container &#39;my_container&#39; already exists</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>Check and list any other containers exist in the database:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">docdb_list</span>(<span class="at">src =</span> src)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;my_container&quot;</span></span></code></pre></div>
</div>
<div id="identifiers" class="section level3">
<h3>Identifiers</h3>
<p>The unique document identifier is its <code>_id</code>, corresponding
to a primary index with a constraint to be unique in SQL databases.</p>
<p>The <code>_id</code>’s of an input <code>value</code> are either the
row names of a data frame (such as <code>mtcars</code>) or top-level
elements with the name <code>_id</code> such as in <code>contacts</code>
shown just above.</p>
<p>Thus, expect a warning when trying to create documents with
<code>_id</code>’s that already exist in the container.</p>
<p>The return value can be <code>0</code> when no documents could newly
be created, or the number of the subset of documents in
<code>value</code> that did not yet exist and could newly be
created.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># zero new documents created</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">docdb_create</span>(src, key, <span class="at">value =</span> mtcars)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; Note: container &#39;my_container&#39; already exists</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; Warning: Could not create some documents, reason: UNIQUE constraint failed</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>For updating existing documents, see below function
<code>docdb_update()</code>.</p>
</div>
<div id="docdb_get" class="section level3">
<h3>docdb_get</h3>
<p>All documents in a container can now be retrieved with
<code>docdb_get()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># use library for more</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># readable print output</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(tibble)) {</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="co"># get all documents, irrespective of schema</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">docdb_get</span>(src, key))</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="co"># get just 2 documents using limit and note that</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="co"># only fields for these documents are returned</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">docdb_get</span>(src, key, <span class="at">limit =</span> <span class="dv">2</span><span class="dt">L</span>))</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>}</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; Loading required package: tibble</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 11</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;   `_id`       isActive balance   age eyeColor name  email about registered tags </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;lgl&gt;    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;lis&gt;</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 1 5cd678530d… TRUE     $2,412…    20 blue     Kris… kris… Sint… 2017-07-1… &lt;chr&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 2 5cd678531b… FALSE    $3,400…    20 brown    Rae … raec… Nisi… 2018-12-1… &lt;chr&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: friends &lt;list&gt;</span></span></code></pre></div>
</div>
<div id="docdb_query" class="section level3">
<h3>docdb_query</h3>
<p>One of the most powerful functions of <code>nodbi</code> is
<code>docdb_query()</code> because it permits to combine a query to
select documents and to filter for fields of interest.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># query for some documents</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">docdb_query</span>(<span class="at">src =</span> src, <span class="at">key =</span> key, <span class="at">query =</span> <span class="st">&#39;{&quot;mpg&quot;: {&quot;$gte&quot;: 30}}&#39;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt;              _id  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; 1       Fiat 128 32.4   4 78.7  66 4.08 2.200 19.47  1  1    4    1</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; 2    Honda Civic 30.4   4 75.7  52 4.93 1.615 18.52  1  1    4    2</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 3 Toyota Corolla 33.9   4 71.1  65 4.22 1.835 19.90  1  1    4    1</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 4   Lotus Europa 30.4   4 95.1 113 3.77 1.513 16.90  1  1    5    2</span></span></code></pre></div>
<p>Both parameters <code>query</code> (obligatory) and
<code>fields</code> (optional) use, across all databases, MongoDB syntax
such as documented for <a href="https://www.mongodb.com/docs/manual/crud/">queries</a> and <a href="https://www.mongodb.com/docs/manual/tutorial/project-fields-from-query-results/">fields</a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># query some fields from some documents; &#39;query&#39; is a mandatory</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co"># parameter and is used here in its position in the signature</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">docdb_query</span>(src, key, <span class="st">&#39;{&quot;mpg&quot;: {&quot;$gte&quot;: 30}}&#39;</span>, <span class="at">fields =</span> <span class="st">&#39;{&quot;wt&quot;: 1, &quot;mpg&quot;: 1}&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;              _id    wt  mpg</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; 1       Fiat 128 2.200 32.4</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; 2    Honda Civic 1.615 30.4</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 3 Toyota Corolla 1.835 33.9</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 4   Lotus Europa 1.513 30.4</span></span></code></pre></div>
<p>Unless <code>fields</code> specifies <code>&quot;_id&quot;: 0</code>, the
<code>_id</code> field is always included in the output of
<code>docdb_query()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># query some fields from some documents, limit return to one document</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">docdb_query</span>(src, key, <span class="st">&#39;{&quot;mpg&quot;: {&quot;$gte&quot;: 30}}&#39;</span>, <span class="at">fields =</span> <span class="st">&#39;{&quot;_id&quot;: 0, &quot;mpg&quot;: 1}&#39;</span>, <span class="at">limit =</span> <span class="dv">1</span><span class="dt">L</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;    mpg</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; 1 32.4</span></span></code></pre></div>
<p>Queries can be more complex such as in this example, showing a dot
notation of a sub-field and an example operator (regular
expression).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># query some subitem fields from some documents</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">docdb_query</span>(</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  src, key,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">query =</span> <span class="st">&#39;{&quot;$or&quot;: [{&quot;age&quot;: {&quot;$gt&quot;: 21}},</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="st">           {&quot;friends.name&quot;: {&quot;$regex&quot;: &quot;^B[a-z]{3,9}.*&quot;}}]}&#39;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">fields =</span> <span class="st">&#39;{&quot;age&quot;: 1, &quot;friends.name&quot;: 1}&#39;</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>))</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    3 obs. of  3 variables:</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;  $ _id         : chr  &quot;5cd67853f841025e65ce0ce2&quot; &quot;5cd6785335b63cb19dfa8347&quot; &quot;5cd6785325ce3a94dfc54096&quot;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;  $ age         : int  23 30 22</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;  $ friends.name:List of 3</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;   ..$ : chr  &quot;Wooten Goodwin&quot; &quot;Brandie Woodward&quot; &quot;Angelique Britt&quot;</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;   ..$ : chr  &quot;Coleen Dunn&quot; &quot;Doris Phillips&quot; &quot;Concetta Turner&quot;</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;   ..$ : chr  &quot;Baird Keller&quot; &quot;Francesca Reese&quot; &quot;Dona Bartlett&quot;</span></span></code></pre></div>
<p>Queries work across documents of different structure such as
here.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># query with results across documents</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">docdb_query</span>(</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  src, key,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">query =</span> <span class="st">&#39;{&quot;$or&quot;: [{&quot;age&quot;: {&quot;$gt&quot;: 21}}, {&quot;mpg&quot;: {&quot;$gte&quot;: 30}}]}&#39;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">fields =</span> <span class="st">&#39;{&quot;name&quot;: 1, &quot;disp&quot;: 1}&#39;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;                        _id              name disp</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; 1                 Fiat 128              &lt;NA&gt; 78.7</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; 2              Honda Civic              &lt;NA&gt; 75.7</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; 3           Toyota Corolla              &lt;NA&gt; 71.1</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; 4             Lotus Europa              &lt;NA&gt; 95.1</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; 5 5cd67853f841025e65ce0ce2         Lacy Chen   NA</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; 6 5cd6785335b63cb19dfa8347 Williamson French   NA</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; 7 5cd6785325ce3a94dfc54096         Pace Bell   NA</span></span></code></pre></div>
</div>
<div id="field-names" class="section level3">
<h3>Field names</h3>
<p>The <code>JSON</code> data handled by package <code>nodbi</code> may
have a large number of field included nested fields in objects (see for
example <code>name</code> within array <code>friends</code> above).
Thus, an argument is provided for <code>docdb_query()</code> so that the
function returns only the comprehensive list of all field names in
documents selected with a query (or in all documents in the container if
<code>query = &quot;{}&quot;</code> is specified).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">docdb_query</span>(src, key, <span class="at">query =</span> <span class="st">&#39;{&quot;_id&quot;: {&quot;$regex&quot;: &quot;^[0-9]&quot;}}&#39;</span>, <span class="at">listfields =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;about&quot;                            &quot;age&quot;                             </span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt;  [3] &quot;balance&quot;                          &quot;destination_addresses&quot;           </span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;email&quot;                            &quot;eyeColor&quot;                        </span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;friends&quot;                          &quot;friends.id&quot;                      </span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;friends.name&quot;                     &quot;isActive&quot;                        </span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; [11] &quot;name&quot;                             &quot;origin_addresses&quot;                </span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; [13] &quot;registered&quot;                       &quot;rows&quot;                            </span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; [15] &quot;rows.elements&quot;                    &quot;rows.elements.distance&quot;          </span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; [17] &quot;rows.elements.distance.somevalue&quot; &quot;rows.elements.distance.text&quot;     </span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; [19] &quot;rows.elements.duration&quot;           &quot;rows.elements.duration.somevalue&quot;</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; [21] &quot;rows.elements.duration.text&quot;      &quot;rows.elements.status&quot;            </span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; [23] &quot;status&quot;                           &quot;tags&quot;</span></span></code></pre></div>
<p>The dot notation is a path from a root field to the nested field, and
this notation can be used in <code>query</code> and <code>fields</code>
parameters of <code>docdb_query()</code>.</p>
</div>
<div id="docdb_update" class="section level3">
<h3>docdb_update</h3>
<p>Queries can also be used for updating (patching) selected documents
with a new <code>value</code>. The return value of
<code>docdb_update()</code> corresponds to the number of documents that
were updated.</p>
<p>This is another powerful function because <code>value</code> can come
from a data frame, a list, a JSON string, or a file name or URL pointing
to <code>NDJSON</code>, and if <code>value</code> includes row names or
<code>_id</code>’s, these are used to identify the documents to be
updated.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># number of documents corresponding to query</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">docdb_query</span>(src, key, <span class="at">query =</span> <span class="st">&#39;{&quot;carb&quot;: 3}&#39;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># update all documents using JSON, replacing the previously existing values</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">docdb_update</span>(src, key, <span class="at">value =</span> <span class="st">&#39;{&quot;vs&quot;: 9, &quot;xy&quot;: [1, 2]}&#39;</span>, <span class="at">query =</span> <span class="st">&#39;{&quot;carb&quot;: 3}&#39;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co"># update with value that includes _id&#39;s</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="fu">docdb_update</span>(src, key, <span class="at">value =</span> <span class="st">&#39;{&quot;_id&quot;: &quot;Merc 450SLC&quot;, &quot;xy&quot;: 33}&#39;</span>, <span class="at">query =</span> <span class="st">&quot;{}&quot;</span>)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co"># show updated values</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="fu">docdb_query</span>(src, key, <span class="at">query =</span> <span class="st">&#39;{&quot;carb&quot;: 3}&#39;</span>, <span class="at">fields =</span> <span class="st">&#39;{&quot;xy&quot;: 1}&#39;</span>)</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt;           _id   xy</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; 1  Merc 450SE 1, 2</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt; 2  Merc 450SL 1, 2</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; 3 Merc 450SLC   33</span></span></code></pre></div>
</div>
<div id="docdb_delete" class="section level3">
<h3>docdb_delete</h3>
<p>Documents and containers can be deleted with
<code>docdb_delete()</code>. Its return value corresponds to the success
of the delete operation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># number of documents corresponding to query</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">docdb_query</span>(src, key, <span class="at">query =</span> <span class="st">&#39;{&quot;age&quot;: {&quot;$lte&quot;: 23}}&#39;</span>))</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co"># to delete selected documents, specify a query parameter</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="fu">docdb_delete</span>(src, key, <span class="at">query =</span> <span class="st">&#39;{&quot;age&quot;: {&quot;$lte&quot;: 23}}&#39;</span>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># this deletes the complete container from database</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="fu">docdb_delete</span>(src, key)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co"># check if still exists</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="fu">docdb_exists</span>(src, key)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div id="disconnect-and-shutdown" class="section level3">
<h3>Disconnect and shutdown</h3>
<p>Package <code>nodbi</code> includes an automatic mechanism for
shutting down, at the time of <code>quit()</code> or session restart,
those databases that require it (SQLite, DuckDB, PostgreSQL).</p>
<p>Nevertheless, it is good practice to manually disconnect and shut
down connections as specific to the database, for example for
SQLite:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>src</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; src: SQLite</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; ver: 3.51.1</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; db(s): :memory:</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; size(s): 0.00338 MB</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># shutdown</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(src<span class="sc">$</span>con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="fu">rm</span>(src)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
